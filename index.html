<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BarStock</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü•É</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2d3748;
            --secondary: #4a5568;
            --accent: #718096;
            --background: #f7fafc;
            --card-bg: #ffffff;
            --text: #1a202c;
            --text-light: #718096;
            --border: #e2e8f0;
            --success: #48bb78;
            --hover: #edf2f7;
        }

        [data-theme="dark"] {
            --primary: #1a202c;
            --secondary: #2d3748;
            --accent: #a0aec0;
            --background: #0f1419;
            --card-bg: #1a202c;
            --text: #f7fafc;
            --text-light: #a0aec0;
            --border: #2d3748;
            --success: #68d391;
            --hover: #2d3748;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: var(--primary);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 1.5rem;
            margin: 0;
            text-align: center;
            font-weight: 600;
        }

        .header-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 12px;
            position: relative;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: background 0.3s;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: background 0.3s;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.2);
        }

        .nav-tab.active {
            background: var(--accent);
        }

        /* Filter Section */
        .filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .filter-toggle-btn {
            width: 100%;
            padding: 12px 20px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.3s;
        }

        .filter-toggle-btn:hover {
            background: var(--primary);
        }

        .filter-toggle-btn .arrow {
            transition: transform 0.3s;
        }

        .filter-toggle-btn.collapsed .arrow {
            transform: rotate(-90deg);
        }

        .filter-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .filter-content.collapsed {
            max-height: 0;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .btn-add-cocktail {
            background: var(--success);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-add-cocktail:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--border);
            background: var(--background);
            color: var(--text);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            border-color: var(--secondary);
            background: var(--hover);
        }

        .filter-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        /* Cocktail Grid */
        .cocktail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Cocktail Card */
        .cocktail-card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .cocktail-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .cocktail-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            transition: opacity 0.3s;
        }

        .cocktail-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cocktail-content {
            padding: 20px;
        }

        .cocktail-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .cocktail-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            flex: 1;
        }

        .cocktail-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .btn-edit {
            background: var(--accent);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.3s;
            white-space: nowrap;
        }

        .btn-edit:hover {
            background: var(--secondary);
        }

        .can-make-badge {
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .cocktail-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .tag {
            background: var(--hover);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .tag.category {
            background: var(--secondary);
            color: white;
        }

        .cocktail-preview {
            font-size: 0.9rem;
            color: var(--text-light);
            line-height: 1.5;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.1);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .modal-close:hover {
            background: rgba(0,0,0,0.2);
        }

        .modal-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 5rem;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-title {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .ingredients-list {
            margin: 20px 0;
        }

        .ingredients-list h3 {
            font-size: 1.2rem;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .ingredient-item {
            padding: 10px;
            margin-bottom: 8px;
            background: var(--hover);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ingredient-item.available {
            background: rgba(72, 187, 120, 0.15);
            border-left: 4px solid var(--success);
        }

        .ingredient-item.unavailable {
            background: rgba(245, 101, 101, 0.15);
            border-left: 4px solid #f56565;
        }

        .steps-list {
            margin: 20px 0;
        }

        .steps-list h3 {
            font-size: 1.2rem;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .step-item {
            padding: 12px;
            margin-bottom: 10px;
            background: var(--hover);
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }

        .step-number {
            font-weight: 700;
            color: var(--secondary);
            margin-right: 8px;
        }

        .source-info {
            margin-top: 20px;
            padding: 15px;
            background: var(--hover);
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* Bar Inventory Section */
        .inventory-section {
            display: none;
        }

        .inventory-section.active {
            display: block;
        }

        .add-item-form {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .add-item-form h2,
        .add-item-form h3 {
            color: var(--text);
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .form-input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .form-select {
            flex: 1;
            min-width: 150px;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text);
        }

        .form-select:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary);
        }

        .btn-secondary {
            background: var(--accent);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--secondary);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .barcode-scanner {
            margin-top: 15px;
            padding: 20px;
            background: var(--hover);
            border-radius: 8px;
            text-align: center;
        }

        #video {
            width: 100%;
            max-width: 500px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .inventory-list {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .inventory-list h2 {
            margin-bottom: 15px;
            color: var(--text);
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .inventory-item {
            padding: 15px;
            background: var(--hover);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inventory-info {
            flex: 1;
        }

        .inventory-name {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .inventory-category {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .btn-remove {
            background: #718096;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .btn-remove:hover {
            background: #4a5568;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            header h1 {
                font-size: 1.3rem;
            }

            .theme-toggle {
                position: static;
                transform: none;
                margin-top: 10px;
            }

            .header-controls {
                flex-direction: column;
            }

            .cocktail-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .modal-content {
                margin: 10px;
            }

            .modal-body {
                padding: 20px;
            }

            .modal-title {
                font-size: 1.5rem;
            }

            .form-row {
                flex-direction: column;
            }

            .form-input,
            .form-select {
                width: 100%;
            }

            .inventory-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>BarStock</h1>
            <div class="header-controls">
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="switchTab('cocktails')">Cocktails</button>
                    <button class="nav-tab" onclick="switchTab('inventory')">My Bar</button>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Cocktails Section -->
        <div id="cocktails-section">
            <div style="margin: 20px 0; display: flex; gap: 10px; align-items: center;">
                <input type="text" class="search-box" id="searchBox" placeholder="Search cocktails..." style="flex: 1;">
                <button class="btn-add-cocktail" onclick="showAddCocktailForm()" style="padding: 12px 20px; white-space: nowrap;">
                    <img src="https://cdn-icons-png.flaticon.com/128/1828/1828817.png" style="width: 16px; height: 16px; filter: brightness(0) invert(1);" alt="Add">
                </button>
            </div>

            <div class="filters">
                <button class="filter-toggle-btn" onclick="toggleFilters()">
                    <span>Filter Cocktails</span>
                    <span class="arrow">‚ñº</span>
                </button>
                
                <div class="filter-content" id="filterContent">
                    <div class="filter-group" style="margin-top: 15px;">
                        <label>Category</label>
                        <div class="filter-buttons" id="categoryFilters"></div>
                    </div>

                    <div class="filter-group">
                        <label>Base Spirit</label>
                        <div class="filter-buttons" id="spiritFilters"></div>
                    </div>

                    <div class="filter-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="canMakeToggle">
                            <span class="slider"></span>
                        </label>
                        <label for="canMakeToggle">Show only cocktails I can make</label>
                    </div>
                </div>
            </div>

            <div class="cocktail-grid" id="cocktailGrid"></div>
        </div>

        <!-- Add Cocktail Section -->
        <div id="add-cocktail-section" class="inventory-section">
            <div class="add-item-form">
                <h2>Create New Cocktail</h2>
                
                <div class="filter-group" style="margin-bottom: 20px;">
                    <label>Import Recipe from URL</label>
                    <div class="form-row">
                        <input type="text" class="form-input" id="importUrl" placeholder="Paste recipe URL to auto-fill (optional)" style="flex: 1;">
                        <button class="btn btn-secondary" onclick="importRecipe()">Import</button>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 5px;">
                        Note: Import functionality requires backend integration
                    </p>
                </div>

                <div class="form-row">
                    <input type="text" class="form-input" id="cocktailName" placeholder="Cocktail name" style="flex: 2;">
                    <input type="text" class="form-input" id="cocktailImage" placeholder="Image URL (optional)">
                </div>
                <div class="form-row">
                    <select class="form-select" id="cocktailCategory">
                        <option value="">Select category...</option>
                        <option value="Classic">Classic</option>
                        <option value="Modern">Modern</option>
                        <option value="Refreshing">Refreshing</option>
                        <option value="Bitter">Bitter</option>
                        <option value="Sweet">Sweet</option>
                        <option value="Sour">Sour</option>
                        <option value="Tropical">Tropical</option>
                    </select>
                    <select class="form-select" id="cocktailSpirit">
                        <option value="">Select base spirit...</option>
                        <option value="Vodka">Vodka</option>
                        <option value="Gin">Gin</option>
                        <option value="Rum">Rum</option>
                        <option value="Tequila">Tequila</option>
                        <option value="Whiskey">Whiskey</option>
                        <option value="Bourbon">Bourbon</option>
                        <option value="Brandy">Brandy</option>
                        <option value="Mezcal">Mezcal</option>
                        <option value="Other">Other</option>
                    </select>
                    <input type="text" class="form-input" id="cocktailSource" placeholder="Source (optional)">
                </div>
                <div class="form-row">
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <label style="font-weight: 600; color: var(--text); white-space: nowrap;">Card Color:</label>
                        <input type="color" id="cocktailColor" style="width: 60px; height: 40px; border: 2px solid var(--border); border-radius: 8px; cursor: pointer;">
                        <button class="btn btn-secondary" onclick="useSpiritColor()" style="padding: 8px 16px; white-space: nowrap;">Use Spirit Color</button>
                        <button class="btn btn-secondary" onclick="randomizeColor()" style="padding: 8px 16px;">Random</button>
                    </div>
                </div>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">Ingredients</h3>
                <div id="ingredientsContainer">
                    <div class="form-row ingredient-row">
                        <input type="text" class="form-input" placeholder="Ingredient name" data-ingredient-name>
                        <input type="text" class="form-input" placeholder="Amount (e.g., 2 oz)" data-ingredient-amount style="max-width: 150px;">
                        <button class="btn btn-remove" onclick="removeIngredientRow(this)">‚úï</button>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="addIngredientRow()" style="margin-top: 10px;">+ Add Ingredient</button>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">Instructions</h3>
                <div id="stepsContainer">
                    <div class="form-row step-row">
                        <input type="text" class="form-input" placeholder="Step description" data-step style="flex: 1;">
                        <button class="btn btn-remove" onclick="removeStepRow(this)">‚úï</button>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="addStepRow()" style="margin-top: 10px;">+ Add Step</button>

                <div class="form-row" style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="saveCocktail()" style="flex: 1;">Save Cocktail</button>
                    <button class="btn btn-secondary" onclick="clearCocktailForm()">Clear Form</button>
                </div>
            </div>
        </div>

        <!-- Inventory Section -->
        <div id="inventory-section" class="inventory-section">
            <div class="add-item-form">
                <h2>Add to Your Bar</h2>
                <div class="form-row">
                    <input type="text" class="form-input" id="itemName" placeholder="Item name (e.g., Vodka, Lime Juice)" style="flex: 2;">
                    <select class="form-select" id="itemCategory">
                        <option value="">Select category...</option>
                        <option value="Spirit">Spirit</option>
                        <option value="Liqueur">Liqueur</option>
                        <option value="Wine - Red">Wine - Red</option>
                        <option value="Wine - White">Wine - White</option>
                        <option value="Wine - Ros√©">Wine - Ros√©</option>
                        <option value="Wine - Orange">Wine - Orange</option>
                        <option value="Wine - Sparkling">Wine - Sparkling</option>
                        <option value="Wine - Dessert">Wine - Dessert</option>
                        <option value="Mixer">Mixer</option>
                        <option value="Juice">Juice</option>
                        <option value="Syrup">Syrup</option>
                        <option value="Bitters">Bitters</option>
                        <option value="Garnish">Garnish</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <input type="text" class="form-input" id="itemBrand" placeholder="Brand (optional)">
                    <input type="text" class="form-input" id="itemModel" placeholder="Model/Variant (optional)">
                    <input type="number" class="form-input" id="itemYear" placeholder="Year" min="1900" max="2030" style="max-width: 120px;">
                </div>
                <div class="form-row">
                    <input type="number" class="form-input" id="itemVolume" placeholder="Volume (ml)" min="0" step="0.1" style="max-width: 150px;">
                    <input type="number" class="form-input" id="itemABV" placeholder="ABV %" min="0" max="100" step="0.1" style="max-width: 150px;">
                    <input type="number" class="form-input" id="itemSugar" placeholder="Sugar (g/L)" min="0" step="0.1" style="max-width: 150px;">
                </div>
                <div class="form-row">
                    <button class="btn btn-primary" onclick="addInventoryItem()" style="width: 100%;">Add Item</button>
                </div>

                <div class="barcode-scanner">
                    <button class="btn btn-secondary" onclick="toggleBarcodeScanner()">
                        <svg style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 6px;" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M4 6h2v12H4zm4 0h1v12H8zm2 0h2v12h-2zm3 0h2v12h-2zm3 0h2v12h-2zm3 0h1v12h-1z"/>
                        </svg>
                        Scan Barcode
                    </button>
                    <div id="scannerContainer" style="display: none; margin-top: 15px;">
                        <video id="video" autoplay playsinline></video>
                        <canvas id="canvas" style="display: none;"></canvas>
                        <p style="margin-top: 10px; font-size: 0.9rem; color: var(--text-light);">
                            Position the barcode in the camera view
                        </p>
                    </div>
                </div>
            </div>

            <div class="inventory-list">
                <h2>Your Bar Inventory (<span id="inventoryCount">0</span> items)</h2>
                
                <!-- Inventory Filters -->
                <div class="filters" style="margin-top: 15px;">
                    <button class="filter-toggle-btn" onclick="toggleInventoryFilters()">
                        <span>Filter Inventory</span>
                        <span class="arrow">‚ñº</span>
                    </button>
                    
                    <div class="filter-content collapsed" id="inventoryFilterContent">
                        <div class="filter-group" style="margin-top: 15px;">
                            <label>Search</label>
                            <input type="text" class="search-box" id="inventorySearchBox" placeholder="Search items...">
                        </div>

                        <div class="filter-group">
                            <label>Category</label>
                            <div class="filter-buttons" id="inventoryCategoryFilters"></div>
                        </div>

                        <div class="filter-group">
                            <label>Volume Range (ml)</label>
                            <div class="form-row">
                                <input type="number" class="form-input" id="volumeMin" placeholder="Min" min="0" step="1">
                                <input type="number" class="form-input" id="volumeMax" placeholder="Max" min="0" step="1">
                            </div>
                        </div>

                        <div class="filter-group">
                            <label>ABV Range (%)</label>
                            <div class="form-row">
                                <input type="number" class="form-input" id="abvMin" placeholder="Min" min="0" max="100" step="0.1">
                                <input type="number" class="form-input" id="abvMax" placeholder="Max" min="0" max="100" step="0.1">
                            </div>
                        </div>

                        <div class="filter-group">
                            <label>Sugar Content Range (g/L)</label>
                            <div class="form-row">
                                <input type="number" class="form-input" id="sugarMin" placeholder="Min" min="0" step="0.1">
                                <input type="number" class="form-input" id="sugarMax" placeholder="Max" min="0" step="0.1">
                            </div>
                        </div>

                        <div class="filter-group">
                            <label>Year Range</label>
                            <div class="form-row">
                                <input type="number" class="form-input" id="yearMin" placeholder="Min" min="1900" max="2030">
                                <input type="number" class="form-input" id="yearMax" placeholder="Max" min="1900" max="2030">
                            </div>
                        </div>

                        <div class="filter-group">
                            <label>Brand</label>
                            <div class="filter-buttons" id="inventoryBrandFilters"></div>
                        </div>
                    </div>
                </div>

                <div class="inventory-grid" id="inventoryGrid"></div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="cocktailModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // Cocktail colors for card backgrounds
        const cocktailColors = [
            '#4a5568', '#2d3748', '#718096', '#1a202c', '#2c5282', 
            '#2f855a', '#c05621', '#744210', '#5f370e', '#9c4221'
        ];

        // Spirit-based color palette
        const spiritColors = {
            'Vodka': '#e2e8f0',      // Light grey/clear - represents vodka's clarity
            'Gin': '#86efac',         // Light green - represents botanicals/juniper
            'Rum': '#d97706',         // Amber/golden - represents aged rum
            'Tequila': '#fbbf24',     // Golden yellow - represents agave/reposado
            'Whiskey': '#92400e',     // Deep brown - represents barrel aging
            'Bourbon': '#b45309',     // Rich amber - represents American oak
            'Brandy': '#7c2d12',      // Dark reddish brown - represents grape spirits
            'Mezcal': '#6b7280',      // Smoky grey - represents smoke/agave
            'Other': '#475569'        // Neutral grey - default
        };

        // Sample cocktail data - in production, this would come from a database
        let cocktails = JSON.parse(localStorage.getItem('cocktails')) || [
            {
                id: 1,
                name: "Margarita",
                category: "Classic",
                baseSpirit: "Tequila",
                image: null,
                color: spiritColors['Tequila'],
                ingredients: [
                    { name: "Tequila", amount: "2 oz" },
                    { name: "Lime Juice", amount: "1 oz" },
                    { name: "Triple Sec", amount: "1 oz" },
                    { name: "Salt", amount: "for rim" }
                ],
                steps: [
                    "Rim glass with salt",
                    "Add tequila, lime juice, and triple sec to shaker with ice",
                    "Shake well for 15 seconds",
                    "Strain into salt-rimmed glass over ice",
                    "Garnish with lime wheel"
                ],
                source: "IBA Official Cocktails"
            },
            {
                id: 2,
                name: "Old Fashioned",
                category: "Classic",
                baseSpirit: "Whiskey",
                image: null,
                color: spiritColors['Whiskey'],
                ingredients: [
                    { name: "Bourbon", amount: "2 oz" },
                    { name: "Sugar Cube", amount: "1" },
                    { name: "Angostura Bitters", amount: "2-3 dashes" },
                    { name: "Orange Peel", amount: "1" }
                ],
                steps: [
                    "Place sugar cube in glass",
                    "Add bitters and muddle",
                    "Add bourbon and stir",
                    "Add large ice cube",
                    "Express orange peel over drink and garnish"
                ],
                source: "Classic Cocktail Guide"
            },
            {
                id: 3,
                name: "Mojito",
                category: "Refreshing",
                baseSpirit: "Rum",
                image: null,
                color: spiritColors['Rum'],
                ingredients: [
                    { name: "White Rum", amount: "2 oz" },
                    { name: "Lime Juice", amount: "1 oz" },
                    { name: "Mint Leaves", amount: "8-10" },
                    { name: "Simple Syrup", amount: "0.5 oz" },
                    { name: "Soda Water", amount: "Top" }
                ],
                steps: [
                    "Muddle mint leaves with simple syrup in glass",
                    "Add lime juice and rum",
                    "Fill glass with ice",
                    "Top with soda water",
                    "Stir gently and garnish with mint sprig"
                ],
                source: "Cuban Classics"
            },
            {
                id: 4,
                name: "Negroni",
                category: "Bitter",
                baseSpirit: "Gin",
                image: null,
                color: spiritColors['Gin'],
                ingredients: [
                    { name: "Gin", amount: "1 oz" },
                    { name: "Campari", amount: "1 oz" },
                    { name: "Sweet Vermouth", amount: "1 oz" },
                    { name: "Orange Peel", amount: "1" }
                ],
                steps: [
                    "Add gin, Campari, and vermouth to mixing glass with ice",
                    "Stir for 30 seconds",
                    "Strain into rocks glass over ice",
                    "Express orange peel and garnish"
                ],
                source: "Italian Aperitifs"
            },
            {
                id: 5,
                name: "Espresso Martini",
                category: "Modern",
                baseSpirit: "Vodka",
                image: null,
                color: spiritColors['Vodka'],
                ingredients: [
                    { name: "Vodka", amount: "2 oz" },
                    { name: "Coffee Liqueur", amount: "0.5 oz" },
                    { name: "Fresh Espresso", amount: "1 oz" },
                    { name: "Simple Syrup", amount: "0.25 oz" }
                ],
                steps: [
                    "Add all ingredients to shaker with ice",
                    "Shake vigorously for 15-20 seconds",
                    "Strain into chilled martini glass",
                    "Garnish with coffee beans"
                ],
                source: "Contemporary Cocktails"
            },
            {
                id: 6,
                name: "Moscow Mule",
                category: "Refreshing",
                baseSpirit: "Vodka",
                image: null,
                color: spiritColors['Vodka'],
                ingredients: [
                    { name: "Vodka", amount: "2 oz" },
                    { name: "Lime Juice", amount: "0.5 oz" },
                    { name: "Ginger Beer", amount: "4 oz" },
                    { name: "Lime Wedge", amount: "1" }
                ],
                steps: [
                    "Fill copper mug with ice",
                    "Add vodka and lime juice",
                    "Top with ginger beer",
                    "Stir gently",
                    "Garnish with lime wedge"
                ],
                source: "Modern Classics"
            }
        ];

        // Bar inventory
        let barInventory = JSON.parse(localStorage.getItem('barInventory')) || [];

        // Inventory filters
        let inventoryFilters = {
            category: null,
            brand: null,
            search: '',
            volumeMin: null,
            volumeMax: null,
            abvMin: null,
            abvMax: null,
            sugarMin: null,
            sugarMax: null,
            yearMin: null,
            yearMax: null
        };

        // Get unique categories and spirits
        const categories = [...new Set(cocktails.map(c => c.category))];
        const spirits = [...new Set(cocktails.map(c => c.baseSpirit))];

        let activeFilters = {
            category: null,
            spirit: null,
            canMake: false,
            search: ''
        };

        // Initialize the app
        function init() {
            // Set default year to current year
            document.getElementById('itemYear').value = new Date().getFullYear();
            
            // Set default cocktail color to Vodka (neutral starting point)
            document.getElementById('cocktailColor').value = spiritColors['Vodka'];
            
            renderFilters();
            renderCocktails();
            renderInventoryFilters();
            renderInventory();

            // Event listeners
            document.getElementById('searchBox').addEventListener('input', (e) => {
                activeFilters.search = e.target.value.toLowerCase();
                renderCocktails();
            });

            document.getElementById('canMakeToggle').addEventListener('change', (e) => {
                activeFilters.canMake = e.target.checked;
                renderCocktails();
            });

            // Inventory filter event listeners
            document.getElementById('inventorySearchBox').addEventListener('input', (e) => {
                inventoryFilters.search = e.target.value.toLowerCase();
                renderInventory();
            });

            ['volumeMin', 'volumeMax', 'abvMin', 'abvMax', 'sugarMin', 'sugarMax', 'yearMin', 'yearMax'].forEach(id => {
                document.getElementById(id).addEventListener('input', (e) => {
                    const value = e.target.value;
                    inventoryFilters[id] = value ? parseFloat(value) : null;
                    renderInventory();
                });
            });
        }

        // Render filter buttons
        function renderFilters() {
            const categoryContainer = document.getElementById('categoryFilters');
            const spiritContainer = document.getElementById('spiritFilters');

            categoryContainer.innerHTML = `
                <button class="filter-btn active" onclick="setFilter('category', null)">All</button>
                ${categories.map(cat => 
                    `<button class="filter-btn" onclick="setFilter('category', '${cat}')">${cat}</button>`
                ).join('')}
            `;

            spiritContainer.innerHTML = `
                <button class="filter-btn active" onclick="setFilter('spirit', null)">All</button>
                ${spirits.map(spirit => 
                    `<button class="filter-btn" onclick="setFilter('spirit', '${spirit}')">${spirit}</button>`
                ).join('')}
            `;
        }

        // Set filter
        function setFilter(type, value) {
            activeFilters[type] = value;
            
            // Update button states
            const container = type === 'category' ? 'categoryFilters' : 'spiritFilters';
            document.querySelectorAll(`#${container} .filter-btn`).forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderCocktails();
        }

        // Check if cocktail can be made
        function canMakeCocktail(cocktail) {
            return cocktail.ingredients.every(ing => 
                barInventory.some(item => 
                    item.name.toLowerCase().includes(ing.name.toLowerCase()) ||
                    ing.name.toLowerCase().includes(item.name.toLowerCase())
                )
            );
        }

        // Filter cocktails
        function filterCocktails() {
            return cocktails.filter(cocktail => {
                // Category filter
                if (activeFilters.category && cocktail.category !== activeFilters.category) {
                    return false;
                }

                // Spirit filter
                if (activeFilters.spirit && cocktail.baseSpirit !== activeFilters.spirit) {
                    return false;
                }

                // Can make filter
                if (activeFilters.canMake && !canMakeCocktail(cocktail)) {
                    return false;
                }

                // Search filter
                if (activeFilters.search) {
                    const searchTerm = activeFilters.search;
                    return cocktail.name.toLowerCase().includes(searchTerm) ||
                           cocktail.ingredients.some(ing => ing.name.toLowerCase().includes(searchTerm));
                }

                return true;
            });
        }

        // Render cocktails
        function renderCocktails() {
            const grid = document.getElementById('cocktailGrid');
            const filtered = filterCocktails();

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üçπ</div>
                        <h3>No cocktails found</h3>
                        <p>Try adjusting your filters</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(cocktail => {
                const canMake = canMakeCocktail(cocktail);
                const bgColor = cocktail.color || cocktailColors[cocktail.id % cocktailColors.length];
                const hasImage = cocktail.image && cocktail.image.trim() !== '';
                
                return `
                    <div class="cocktail-card">
                        <div class="cocktail-image" style="background: ${hasImage ? `url('${cocktail.image}') center/cover` : bgColor};" onclick="openModal(${cocktail.id})">
                            ${!hasImage ? 'üç∏' : ''}
                        </div>
                        <div class="cocktail-content" onclick="openModal(${cocktail.id})">
                            <div class="cocktail-header">
                                <h3 class="cocktail-name">${cocktail.name}</h3>
                                <div class="cocktail-actions">
                                    ${canMake ? '<span class="can-make-badge">Can Make!</span>' : ''}
                                </div>
                            </div>
                            <div class="cocktail-tags">
                                <span class="tag category">${cocktail.category}</span>
                                <span class="tag">${cocktail.baseSpirit}</span>
                            </div>
                            <div class="cocktail-preview">
                                ${cocktail.ingredients.slice(0, 3).map(ing => ing.name).join(', ')}
                                ${cocktail.ingredients.length > 3 ? '...' : ''}
                            </div>
                        </div>
                        <div style="padding: 0 20px 15px;">
                            <button class="btn-edit" onclick="event.stopPropagation(); editCocktail(${cocktail.id})">
                                <img src="https://cdn-icons-png.flaticon.com/128/3917/3917376.png" style="width: 14px; height: 14px; display: inline-block; vertical-align: middle; margin-right: 4px; filter: brightness(0) invert(1);" alt="Edit">
                                Edit
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Open modal
        function openModal(cocktailId) {
            const cocktail = cocktails.find(c => c.id === cocktailId);
            if (!cocktail) return;

            const modal = document.getElementById('cocktailModal');
            const content = document.getElementById('modalContent');
            const bgColor = cocktail.color || cocktailColors[cocktail.id % cocktailColors.length];
            const hasImage = cocktail.image && cocktail.image.trim() !== '';
            
            // Check if source is a URL
            const isUrl = cocktail.source && (cocktail.source.startsWith('http://') || cocktail.source.startsWith('https://'));
            const sourceHtml = isUrl 
                ? `<a href="${cocktail.source}" target="_blank" rel="noopener noreferrer" style="color: var(--secondary); text-decoration: underline;">${cocktail.source}</a>`
                : cocktail.source;

            content.innerHTML = `
                <div class="modal-image" style="background: ${hasImage ? `url('${cocktail.image}') center/cover` : bgColor};">
                    ${!hasImage ? 'üç∏' : ''}
                </div>
                <div class="modal-body">
                    <h2 class="modal-title">${cocktail.name}</h2>
                    <div class="cocktail-tags">
                        <span class="tag category">${cocktail.category}</span>
                        <span class="tag">${cocktail.baseSpirit}</span>
                    </div>

                    <div class="ingredients-list">
                        <h3>Ingredients</h3>
                        ${cocktail.ingredients.map(ing => {
                            const available = barInventory.some(item => 
                                item.name.toLowerCase().includes(ing.name.toLowerCase()) ||
                                ing.name.toLowerCase().includes(item.name.toLowerCase())
                            );
                            return `
                                <div class="ingredient-item ${available ? 'available' : 'unavailable'}">
                                    <span>${ing.name}</span>
                                    <strong>${ing.amount}</strong>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div class="steps-list">
                        <h3>Instructions</h3>
                        ${cocktail.steps.map((step, index) => `
                            <div class="step-item">
                                <span class="step-number">${index + 1}.</span>
                                ${step}
                            </div>
                        `).join('')}
                    </div>

                    <div class="source-info">
                        <strong>Source:</strong> ${sourceHtml}
                    </div>
                </div>
            `;

            modal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('cocktailModal').classList.remove('active');
        }

        // Switch tabs
        function switchTab(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Hide all sections
            document.getElementById('cocktails-section').style.display = 'none';
            document.getElementById('add-cocktail-section').classList.remove('active');
            document.getElementById('inventory-section').classList.remove('active');

            // Show selected section
            if (tab === 'cocktails') {
                document.getElementById('cocktails-section').style.display = 'block';
            } else if (tab === 'add-cocktail') {
                document.getElementById('add-cocktail-section').classList.add('active');
            } else if (tab === 'inventory') {
                document.getElementById('inventory-section').classList.add('active');
            }
        }

        // Add inventory item
        function addInventoryItem() {
            const name = document.getElementById('itemName').value.trim();
            const category = document.getElementById('itemCategory').value;
            const brand = document.getElementById('itemBrand').value.trim();
            const model = document.getElementById('itemModel').value.trim();
            const year = document.getElementById('itemYear').value;
            const volume = document.getElementById('itemVolume').value;
            const abv = document.getElementById('itemABV').value;
            const sugar = document.getElementById('itemSugar').value;

            if (!name || !category) {
                alert('Please enter both item name and category');
                return;
            }

            barInventory.push({ 
                name, 
                category,
                brand: brand || null,
                model: model || null,
                year: year ? parseInt(year) : null,
                volume: volume ? parseFloat(volume) : null,
                abv: abv ? parseFloat(abv) : null,
                sugar: sugar ? parseFloat(sugar) : null
            });
            localStorage.setItem('barInventory', JSON.stringify(barInventory));

            document.getElementById('itemName').value = '';
            document.getElementById('itemCategory').value = '';
            document.getElementById('itemBrand').value = '';
            document.getElementById('itemModel').value = '';
            document.getElementById('itemYear').value = new Date().getFullYear();
            document.getElementById('itemVolume').value = '';
            document.getElementById('itemABV').value = '';
            document.getElementById('itemSugar').value = '';

            renderInventoryFilters();
            renderInventory();
            renderCocktails(); // Update can-make badges
        }

        // Remove inventory item
        function removeInventoryItem(index) {
            barInventory.splice(index, 1);
            localStorage.setItem('barInventory', JSON.stringify(barInventory));
            renderInventory();
            renderCocktails();
        }

        // Filter inventory
        function filterInventory() {
            return barInventory.filter(item => {
                // Search filter
                if (inventoryFilters.search) {
                    const searchTerm = inventoryFilters.search.toLowerCase();
                    const matchesSearch = item.name.toLowerCase().includes(searchTerm) ||
                                        (item.brand && item.brand.toLowerCase().includes(searchTerm)) ||
                                        (item.model && item.model.toLowerCase().includes(searchTerm));
                    if (!matchesSearch) return false;
                }

                // Category filter
                if (inventoryFilters.category && item.category !== inventoryFilters.category) {
                    return false;
                }

                // Brand filter
                if (inventoryFilters.brand && item.brand !== inventoryFilters.brand) {
                    return false;
                }

                // Volume range
                if (inventoryFilters.volumeMin !== null && (item.volume === null || item.volume < inventoryFilters.volumeMin)) {
                    return false;
                }
                if (inventoryFilters.volumeMax !== null && (item.volume === null || item.volume > inventoryFilters.volumeMax)) {
                    return false;
                }

                // ABV range
                if (inventoryFilters.abvMin !== null && (item.abv === null || item.abv < inventoryFilters.abvMin)) {
                    return false;
                }
                if (inventoryFilters.abvMax !== null && (item.abv === null || item.abv > inventoryFilters.abvMax)) {
                    return false;
                }

                // Sugar range
                if (inventoryFilters.sugarMin !== null && (item.sugar === null || item.sugar < inventoryFilters.sugarMin)) {
                    return false;
                }
                if (inventoryFilters.sugarMax !== null && (item.sugar === null || item.sugar > inventoryFilters.sugarMax)) {
                    return false;
                }

                // Year range
                if (inventoryFilters.yearMin !== null && (item.year === null || item.year < inventoryFilters.yearMin)) {
                    return false;
                }
                if (inventoryFilters.yearMax !== null && (item.year === null || item.year > inventoryFilters.yearMax)) {
                    return false;
                }

                return true;
            });
        }

        // Render inventory
        function renderInventory() {
            const grid = document.getElementById('inventoryGrid');
            const count = document.getElementById('inventoryCount');
            const filtered = filterInventory();

            count.textContent = filtered.length;

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üçæ</div>
                        <h3>No items found</h3>
                        <p>${barInventory.length === 0 ? 'Add items to see which cocktails you can make' : 'Try adjusting your filters'}</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map((item, index) => {
                const details = [];
                if (item.brand) details.push(item.brand);
                if (item.model) details.push(item.model);
                if (item.volume) details.push(`${item.volume}ml`);
                if (item.abv) details.push(`${item.abv}% ABV`);
                if (item.sugar) details.push(`${item.sugar}g/L sugar`);
                if (item.year) details.push(`Year: ${item.year}`);
                
                return `
                    <div class="inventory-item">
                        <div class="inventory-info">
                            <div class="inventory-name">${item.name}</div>
                            <div class="inventory-category">${item.category}</div>
                            ${details.length > 0 ? `<div class="inventory-category" style="margin-top: 4px;">${details.join(' ‚Ä¢ ')}</div>` : ''}
                        </div>
                        <button class="btn-remove" onclick="removeInventoryItem(${barInventory.indexOf(item)})">
                            <img src="https://cdn-icons-png.flaticon.com/128/3917/3917242.png" style="width: 14px; height: 14px; filter: brightness(0) invert(1);" alt="Delete">
                        </button>
                    </div>
                `;
            }).join('');
        }

        // Barcode scanner functionality
        let stream = null;
        let scanning = false;

        async function toggleBarcodeScanner() {
            const container = document.getElementById('scannerContainer');
            const video = document.getElementById('video');

            if (!scanning) {
                container.style.display = 'block';
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'environment' } 
                    });
                    video.srcObject = stream;
                    scanning = true;
                    
                    // In a real implementation, you would use a library like QuaggaJS
                    // or ZXing to decode barcodes from the video stream
                    alert('Barcode scanning requires additional libraries (QuaggaJS or ZXing). ' +
                          'This is a placeholder. In production, integrate a barcode scanning library.');
                } catch (err) {
                    alert('Camera access denied or not available');
                    container.style.display = 'none';
                }
            } else {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                container.style.display = 'none';
                scanning = false;
            }
        }

        // Import recipe from URL
        async function importRecipe() {
            const url = document.getElementById('importUrl').value.trim();
            if (!url) {
                alert('Please enter a recipe URL');
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert('Please enter a valid URL starting with http:// or https://');
                return;
            }

            const importBtn = event.target;
            importBtn.disabled = true;
            importBtn.textContent = 'Importing...';

            try {
                // Fetch the webpage content
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1000,
                        messages: [{
                            role: 'user',
                            content: `Please fetch and analyze this cocktail recipe URL: ${url}

Extract the following information and return it as a JSON object:
- name: cocktail name
- category: one of (Classic, Modern, Refreshing, Bitter, Sweet, Sour, Tropical)
- baseSpirit: primary alcohol (Vodka, Gin, Rum, Tequila, Whiskey, Bourbon, Brandy, Mezcal, Other)
- ingredients: array of objects with {name, amount}
- steps: array of instruction strings
- source: the URL
- image: image URL if found, otherwise null

Return ONLY the JSON object, no other text.`
                        }],
                        tools: [{
                            type: 'web_search_20250305',
                            name: 'web_search'
                        }]
                    })
                });

                const data = await response.json();
                
                // Extract text from response
                let recipeText = '';
                if (data.content) {
                    for (const item of data.content) {
                        if (item.type === 'text') {
                            recipeText += item.text;
                        }
                    }
                }

                // Try to parse JSON from the response
                const jsonMatch = recipeText.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('Could not extract recipe data');
                }

                const recipe = JSON.parse(jsonMatch[0]);

                // Fill in the form
                if (recipe.name) document.getElementById('cocktailName').value = recipe.name;
                if (recipe.category) document.getElementById('cocktailCategory').value = recipe.category;
                if (recipe.baseSpirit) document.getElementById('cocktailSpirit').value = recipe.baseSpirit;
                if (recipe.source) document.getElementById('cocktailSource').value = recipe.source;
                if (recipe.image) document.getElementById('cocktailImage').value = recipe.image;

                // Fill ingredients
                if (recipe.ingredients && recipe.ingredients.length > 0) {
                    const ingredientsContainer = document.getElementById('ingredientsContainer');
                    ingredientsContainer.innerHTML = '';
                    recipe.ingredients.forEach(ing => {
                        const row = document.createElement('div');
                        row.className = 'form-row ingredient-row';
                        row.innerHTML = `
                            <input type="text" class="form-input" placeholder="Ingredient name" data-ingredient-name value="${ing.name || ''}">
                            <input type="text" class="form-input" placeholder="Amount (e.g., 2 oz)" data-ingredient-amount style="max-width: 150px;" value="${ing.amount || ''}">
                            <button class="btn btn-remove" onclick="removeIngredientRow(this)">‚úï</button>
                        `;
                        ingredientsContainer.appendChild(row);
                    });
                }

                // Fill steps
                if (recipe.steps && recipe.steps.length > 0) {
                    const stepsContainer = document.getElementById('stepsContainer');
                    stepsContainer.innerHTML = '';
                    recipe.steps.forEach(step => {
                        const row = document.createElement('div');
                        row.className = 'form-row step-row';
                        row.innerHTML = `
                            <input type="text" class="form-input" placeholder="Step description" data-step style="flex: 1;" value="${step}">
                            <button class="btn btn-remove" onclick="removeStepRow(this)">‚úï</button>
                        `;
                        stepsContainer.appendChild(row);
                    });
                }

                alert('Recipe imported successfully! Please review and adjust as needed.');

            } catch (error) {
                console.error('Import error:', error);
                alert('Failed to import recipe. The URL may not be accessible or may not contain a valid cocktail recipe. Error: ' + error.message);
            } finally {
                importBtn.disabled = false;
                importBtn.textContent = 'Import';
            }
        }

        // Randomize cocktail color
        function randomizeColor() {
            const randomColor = cocktailColors[Math.floor(Math.random() * cocktailColors.length)];
            document.getElementById('cocktailColor').value = randomColor;
        }

        // Use spirit color based on selected base spirit
        function useSpiritColor() {
            const baseSpirit = document.getElementById('cocktailSpirit').value;
            if (!baseSpirit) {
                alert('Please select a base spirit first');
                return;
            }
            const color = spiritColors[baseSpirit] || spiritColors['Other'];
            document.getElementById('cocktailColor').value = color;
        }

        // Toggle filters
        function toggleFilters() {
            const content = document.getElementById('filterContent');
            const btn = event.target.closest('.filter-toggle-btn');
            content.classList.toggle('collapsed');
            btn.classList.toggle('collapsed');
        }

        // Toggle inventory filters
        function toggleInventoryFilters() {
            const content = document.getElementById('inventoryFilterContent');
            const btn = event.target.closest('.filter-toggle-btn');
            content.classList.toggle('collapsed');
            btn.classList.toggle('collapsed');
        }

        // Show add cocktail form
        let editingCocktailId = null;

        function showAddCocktailForm() {
            editingCocktailId = null;
            clearCocktailForm();
            switchTab('add-cocktail');
            // Manually update active tab
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('cocktails-section').style.display = 'none';
            document.getElementById('add-cocktail-section').classList.add('active');
            document.getElementById('inventory-section').classList.remove('active');
            
            // Update form title
            document.querySelector('#add-cocktail-section h2').textContent = 'Create New Cocktail';
        }

        // Edit cocktail
        function editCocktail(cocktailId) {
            const cocktail = cocktails.find(c => c.id === cocktailId);
            if (!cocktail) return;

            editingCocktailId = cocktailId;

            // Switch to add-cocktail section
            document.getElementById('cocktails-section').style.display = 'none';
            document.getElementById('add-cocktail-section').classList.add('active');
            document.getElementById('inventory-section').classList.remove('active');
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));

            // Update form title
            document.querySelector('#add-cocktail-section h2').textContent = 'Edit Cocktail';

            // Populate form
            document.getElementById('cocktailName').value = cocktail.name;
            document.getElementById('cocktailImage').value = cocktail.image || '';
            document.getElementById('cocktailCategory').value = cocktail.category;
            document.getElementById('cocktailSpirit').value = cocktail.baseSpirit;
            document.getElementById('cocktailSource').value = cocktail.source;
            document.getElementById('cocktailColor').value = cocktail.color || spiritColors[cocktail.baseSpirit] || spiritColors['Other'];

            // Populate ingredients
            const ingredientsContainer = document.getElementById('ingredientsContainer');
            ingredientsContainer.innerHTML = '';
            cocktail.ingredients.forEach(ing => {
                const row = document.createElement('div');
                row.className = 'form-row ingredient-row';
                row.innerHTML = `
                    <input type="text" class="form-input" placeholder="Ingredient name" data-ingredient-name value="${ing.name}">
                    <input type="text" class="form-input" placeholder="Amount (e.g., 2 oz)" data-ingredient-amount style="max-width: 150px;" value="${ing.amount}">
                    <button class="btn btn-remove" onclick="removeIngredientRow(this)">‚úï</button>
                `;
                ingredientsContainer.appendChild(row);
            });

            // Populate steps
            const stepsContainer = document.getElementById('stepsContainer');
            stepsContainer.innerHTML = '';
            cocktail.steps.forEach(step => {
                const row = document.createElement('div');
                row.className = 'form-row step-row';
                row.innerHTML = `
                    <input type="text" class="form-input" placeholder="Step description" data-step style="flex: 1;" value="${step}">
                    <button class="btn btn-remove" onclick="removeStepRow(this)">‚úï</button>
                `;
                stepsContainer.appendChild(row);
            });

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Render inventory filters
        function renderInventoryFilters() {
            // Category filters
            const categories = [...new Set(barInventory.map(i => i.category).filter(c => c))];
            const categoryContainer = document.getElementById('inventoryCategoryFilters');
            categoryContainer.innerHTML = `
                <button class="filter-btn ${!inventoryFilters.category ? 'active' : ''}" onclick="setInventoryFilter('category', null)">All</button>
                ${categories.map(cat => 
                    `<button class="filter-btn ${inventoryFilters.category === cat ? 'active' : ''}" onclick="setInventoryFilter('category', '${cat}')">${cat}</button>`
                ).join('')}
            `;

            // Brand filters
            const brands = [...new Set(barInventory.map(i => i.brand).filter(b => b))];
            const brandContainer = document.getElementById('inventoryBrandFilters');
            if (brands.length > 0) {
                brandContainer.innerHTML = `
                    <button class="filter-btn ${!inventoryFilters.brand ? 'active' : ''}" onclick="setInventoryFilter('brand', null)">All</button>
                    ${brands.map(brand => 
                        `<button class="filter-btn ${inventoryFilters.brand === brand ? 'active' : ''}" onclick="setInventoryFilter('brand', '${brand}')">${brand}</button>`
                    ).join('')}
                `;
            } else {
                brandContainer.innerHTML = '<p style="color: var(--text-light); font-size: 0.9rem;">No brands added yet</p>';
            }
        }

        // Set inventory filter
        function setInventoryFilter(type, value) {
            inventoryFilters[type] = value;
            renderInventoryFilters();
            renderInventory();
        }

        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        // Add ingredient row
        function addIngredientRow() {
            const container = document.getElementById('ingredientsContainer');
            const row = document.createElement('div');
            row.className = 'form-row ingredient-row';
            row.innerHTML = `
                <input type="text" class="form-input" placeholder="Ingredient name" data-ingredient-name>
                <input type="text" class="form-input" placeholder="Amount (e.g., 2 oz)" data-ingredient-amount style="max-width: 150px;">
                <button class="btn btn-remove" onclick="removeIngredientRow(this)">‚úï</button>
            `;
            container.appendChild(row);
        }

        // Remove ingredient row
        function removeIngredientRow(button) {
            const container = document.getElementById('ingredientsContainer');
            if (container.children.length > 1) {
                button.parentElement.remove();
            }
        }

        // Add step row
        function addStepRow() {
            const container = document.getElementById('stepsContainer');
            const row = document.createElement('div');
            row.className = 'form-row step-row';
            row.innerHTML = `
                <input type="text" class="form-input" placeholder="Step description" data-step style="flex: 1;">
                <button class="btn btn-remove" onclick="removeStepRow(this)">‚úï</button>
            `;
            container.appendChild(row);
        }

        // Remove step row
        function removeStepRow(button) {
            const container = document.getElementById('stepsContainer');
            if (container.children.length > 1) {
                button.parentElement.remove();
            }
        }

        // Clear cocktail form
        function clearCocktailForm() {
            document.getElementById('importUrl').value = '';
            document.getElementById('cocktailName').value = '';
            document.getElementById('cocktailImage').value = '';
            document.getElementById('cocktailCategory').value = '';
            document.getElementById('cocktailSpirit').value = '';
            document.getElementById('cocktailSource').value = '';
            document.getElementById('cocktailColor').value = spiritColors['Vodka'];
            
            // Reset to one ingredient row
            const ingredientsContainer = document.getElementById('ingredientsContainer');
            ingredientsContainer.innerHTML = `
                <div class="form-row ingredient-row">
                    <input type="text" class="form-input" placeholder="Ingredient name" data-ingredient-name>
                    <input type="text" class="form-input" placeholder="Amount (e.g., 2 oz)" data-ingredient-amount style="max-width: 150px;">
                    <button class="btn btn-remove" onclick="removeIngredientRow(this)">‚úï</button>
                </div>
            `;
            
            // Reset to one step row
            const stepsContainer = document.getElementById('stepsContainer');
            stepsContainer.innerHTML = `
                <div class="form-row step-row">
                    <input type="text" class="form-input" placeholder="Step description" data-step style="flex: 1;">
                    <button class="btn btn-remove" onclick="removeStepRow(this)">‚úï</button>
                </div>
            `;
        }

        // Save cocktail
        function saveCocktail() {
            const name = document.getElementById('cocktailName').value.trim();
            const image = document.getElementById('cocktailImage').value.trim();
            const category = document.getElementById('cocktailCategory').value;
            const baseSpirit = document.getElementById('cocktailSpirit').value;
            const source = document.getElementById('cocktailSource').value.trim() || 'User Created';
            const color = document.getElementById('cocktailColor').value;

            if (!name || !category || !baseSpirit) {
                alert('Please fill in cocktail name, category, and base spirit');
                return;
            }

            // Get ingredients
            const ingredientRows = document.querySelectorAll('.ingredient-row');
            const ingredients = [];
            ingredientRows.forEach(row => {
                const nameInput = row.querySelector('[data-ingredient-name]');
                const amountInput = row.querySelector('[data-ingredient-amount]');
                if (nameInput.value.trim() && amountInput.value.trim()) {
                    ingredients.push({
                        name: nameInput.value.trim(),
                        amount: amountInput.value.trim()
                    });
                }
            });

            if (ingredients.length === 0) {
                alert('Please add at least one ingredient');
                return;
            }

            // Get steps
            const stepRows = document.querySelectorAll('.step-row');
            const steps = [];
            stepRows.forEach(row => {
                const stepInput = row.querySelector('[data-step]');
                if (stepInput.value.trim()) {
                    steps.push(stepInput.value.trim());
                }
            });

            if (steps.length === 0) {
                alert('Please add at least one instruction step');
                return;
            }

            if (editingCocktailId !== null) {
                // Edit existing cocktail
                const index = cocktails.findIndex(c => c.id === editingCocktailId);
                if (index !== -1) {
                    cocktails[index] = {
                        ...cocktails[index],
                        name,
                        category,
                        baseSpirit,
                        image: image || null,
                        color: color,
                        ingredients,
                        steps,
                        source
                    };
                    localStorage.setItem('cocktails', JSON.stringify(cocktails));
                    alert(`Cocktail "${name}" updated successfully!`);
                }
            } else {
                // Create new cocktail
                const newCocktail = {
                    id: Math.max(...cocktails.map(c => c.id), 0) + 1,
                    name,
                    category,
                    baseSpirit,
                    image: image || null,
                    color: color || spiritColors[baseSpirit] || spiritColors['Other'],
                    ingredients,
                    steps,
                    source
                };

                cocktails.push(newCocktail);
                localStorage.setItem('cocktails', JSON.stringify(cocktails));
                alert(`Cocktail "${name}" created successfully!`);
            }

            // Clear form and switch to cocktails view
            clearCocktailForm();
            editingCocktailId = null;
            
            // Update filters and render
            renderFilters();
            renderCocktails();
            
            // Switch to cocktails tab
            switchTab('cocktails');
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-tab')[0].classList.add('active');
        }

        // Close modal on outside click
        document.getElementById('cocktailModal').addEventListener('click', (e) => {
            if (e.target.id === 'cocktailModal') {
                closeModal();
            }
        });

        // Initialize app
        loadTheme();
        init();
    </script>
</body>
</html>
